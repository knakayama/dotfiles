sam() {
  local template_file="$1"
  local s3_bucket="$2"
  local stack_name="$3"

  aws cloudformation package \
    --template-file "$template_file" \
    --output-template-file "output.yml" \
    --s3-bucket "$s3_bucket" \
  && aws cloudformation deploy \
    --template-file "output.yml" \
    --stack-name "$stack_name" \
    --capabilities "CAPABILITY_IAM" \
  | while read line; do
    printf "\n$line\n"
    aws cloudformation describe-stack-events \
      --stack-name "$stack_name" \
      --output text \
      --query 'StackEvents[*].[ResourceStatus,LogicalResourceId,ResourceType,Timestamp]' \
    | sort -k4r \
    | perl -ane 'print if !$seen{$F[1]}++' \
    | column -t
  done
}

# Local Variables:
# mode: Shell-Script
# sh-indentation: 2
# indent-tabs-mode: nil
# sh-basic-offset: 2
# End:
# vim: ft=zsh sw=2 ts=2 et
