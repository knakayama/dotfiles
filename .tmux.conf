##### Basic Settings #####

# https://github.com/ChrisJohnsen/tmux-MacOSX-pasteboard
if-shell "[ which reattach-to-user-namespace >/dev/null 2>&1 ]" "set-option -g default-command 'reattach-to-user-namespace -l zsh'"

unbind-key C-t
set-option -g prefix C-t
bind-key C-t send-prefix

# change paste buffer to 20
set-option -g buffer-limit 20

# change buffer log to 60000
set-option -g history-limit 60000

# copy mode for vi
set-window-option -g mode-keys vi
bind-key -t vi-copy v begin-selection
bind-key -t vi-copy C-v rectangle-toggle
if-shell "[ "$(uname -s)" != 'Darwin' ]" "bind-key -t vi-copy y copy-selection"

# mac os x setting
if-shell "[ "$(uname -s)" = 'Darwin' -a -x $(brew --prefix)/bin/reattach-to-user-namespace ]" "bind-key -t vi-copy y copy-pipe 'reattach-to-user-namespace pbcopy'"

# reload ~/.tmux.conf
set-option -g message-fg white
set-option -g message-bg black
set-option -g message-attr bright
unbind-key r
bind-key r source-file $HOME/.tmux.conf\; display-message "$HOME/.tmux.conf Reloaded!"

# moving between panes like vim
bind-key h select-pane -L
bind-key j select-pane -D
bind-key k select-pane -U
bind-key l select-pane -R

# no prefixed pane move
#bind-key -n C-o select-pane -t :.+

# toggle synchronize-panes mode
bind-key m set-window-option synchronize-panes

# join-pane: the format is session:window.pane
bind-key f command-prompt -p "join pane from:"  "join-pane -s '%%'"
bind-key t command-prompt -p "send pane to:"    "join-pane -t '%%'"

##### Window Settings #####

set-option -g base-index 1
set-option -g renumber-windows on

# window status color
set-window-option -g window-status-fg white
set-window-option -g window-status-bg black
set-window-option -g window-status-attr bold

# current window status color
set-window-option -g window-status-current-fg cyan
set-window-option -g window-status-current-bg black
set-window-option -g window-status-current-attr bold

##### Pane Settings #####

set-window-option -g pane-base-index 1

# pane inactive border color
set-option -g pane-border-fg white
set-option -g pane-border-bg default
# pane active border color
set-option -g pane-active-border-fg cyan
set-option -g pane-active-border-bg default

# 256 color
set-option -g default-terminal "xterm-256color"

##### Status Settings #####

set-option -g status on
set-option -g status-interval 5
set-option -g status-utf8 on

# status bar color
set-option -g status-fg cyan
set-option -g status-bg black

# status left
set-option -g status-left-length 60
set-option -g status-left '#[fg=white,bg=black,bold] %m/%d(%a)%H:%M#[fg=white]#[default] > '

# status right
set-option -g status-right-length 90
if-shell "[ -d ${HOME}/Maildir  ]" "set-option -g status-right '\
#[fg=white,bg=black,bold]#{cpu}#[default] \
< #[fg=white,bg=black,bold]#{mem}#[default] \
< #[fg=white,bg=black,bold]#{uptime}#[default] \
< #[fg=white,bg=black,bold]#{online_status}#[default]\
< #[fg=white,bg=black,bold]#{battery_percentage}#[default] \
< #[fg=white,bg=black,bold]#{email_notifier}#[default]\
'"

if-shell "[ ! -d ${HOME}/Maildir ]" "set-option -g status-right '\
#[fg=white,bg=black,bold]#{cpu}#[default] \
< #[fg=white,bg=black,bold]#{mem}#[default] \
< #[fg=white,bg=black,bold]#{uptime}#[default] \
< #[fg=white,bg=black,bold]#{online_status}#[default]\
< #[fg=white,bg=black,bold]#{battery_percentage}#[default] \
'"

##### tmux plugin manager #####

# tpm plugin list
set-option -g @tpm_plugins '          \
    tmux-plugins/tmux-resurrect       \
    tmux-plugins/tmux-open            \
    tmux-plugins/tmux-online-status   \
    tmux-plugins/tmux-battery         \
    knakayama/tmux-cpu                \
    knakayama/tmux-mem                \
    knakayama/tmux-uptime             \
    knakayama/tmux-newline-detecter   \
    knakayama/tmux-logging-ssh        \
    knakayama/tmux-email-notifier     \
'

# tmux-online-status
set-option -g @online_icon  "Online"
set-option -g @offline_icon "#[fg=red]Offline#[default]"

# tmux-email-notifier
set-option -g @check_dir "$HOME/Maildir/misc/new"

# load plugins
if-shell "[ -x ${HOME}/.tmux/plugins/tpm/tpm ]" "run-shell ${HOME}/.tmux/plugins/tpm/tpm"
